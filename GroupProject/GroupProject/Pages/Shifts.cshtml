@page
@using DataItems.LogicItems;
@model Shifts
@{
    Layout = "Shared/_Login2Layout";
}
<h1>@ViewData["Title"]</h1>

<h4>Shifts for the week of @Model.NewDate.AddDays(0 - (int)Model.NewDate.DayOfWeek + 1).ToShortDateString() - @Model.NewDate.AddDays(6 - (int)Model.NewDate.DayOfWeek + 1).ToShortDateString()</h4>

<!--=====================================-->
<!--=        OLD DESIGN CODE         =-->
<!--=====================================-->

@* <div class="schedule"> *@
@* *@
@*     <form method="post" > *@
@*         <button class="btn btn-dark mt-3 mb-3" asp-page-handler="PreviousWeek">Previous Week</button> *@
@*         <button class="btn btn-dark mt-3 mb-3" asp-page-handler="CurrentWeek">Current Week</button> *@
@*         <button class="btn btn-dark mt-3 mb-3" asp-page-handler="NextWeek">Next Week </button> *@
@*     </form> *@
@* *@
@* </div> *@
@* *@
@* <table class="table text-center"> *@
@*     <thead> *@
@*         <tr> *@
@*             <th class="p-4">Shift Type</th> *@
@*             @for (int dayIndex = 0; dayIndex < Model.WeekDays.Count; dayIndex++) *@
@*             { *@
@*                 var day = Model.WeekDays[dayIndex]; *@
@*                 var date = Model.NewDate.AddDays(dayIndex - (int)Model.NewDate.DayOfWeek + 1); *@
@*                 <th class="@(date.Date == DateTime.Today ? "table-info" : "") p-4">@day<br />@date.ToString("dd-MM-yyyy")</th> *@
@*             } *@
@*         </tr> *@
@*     </thead> *@
@*     <tbody> *@
@*         <tr> *@
@*             <td class="p-4">Morning</td> *@
@*             @for (int dayIndex = 0; dayIndex < Model.WeekDays.Count; dayIndex++) *@
@*             { *@
@*                 bool working = false; *@
@*                 int id = 0; *@
@*                 foreach (Shift shift in Model._assignedShifts) *@
@*                 { *@
@*                     if (shift.Date == Model.NewDate.AddDays(dayIndex - (int)Model.NewDate.DayOfWeek + 1) && shift.Type == (int)ShiftType.Morning) *@
@*                     { *@
@*                         working = true; *@
@*                         id = shift.Id; *@
@*                     } *@
@* *@
@*                 } *@
@* *@
@*                 <td class="@(working ? "table-danger" : "table-success") p-4"> *@
@*                     @((working ? "Working" : "Not Working")); *@
@*                     @if (working && Model.shiftIdsToCancel.Contains(id)) *@
@*                     { *@
@*                         <a asp-page="/CallInSick" asp-route-id="@id" class="btn btn-primary btn-sm w-100">Cancel</a> *@
@*                     } *@
@* *@
@*                 </td> *@
@*             } *@
@*         </tr> *@
@*         <tr> *@
@*             <td class="p-4">Afternoon</td> *@
@*             @for (int dayIndex = 0; dayIndex < Model.WeekDays.Count; dayIndex++) *@
@*             { *@
@*                 bool working = false; *@
@*                 int id = 0; *@
@*                 foreach (Shift shift in Model._assignedShifts) *@
@*                 { *@
@*                     if (shift.Date == Model.NewDate.AddDays(dayIndex - (int)Model.NewDate.DayOfWeek + 1) && shift.Type == (int)ShiftType.Afternoon) *@
@*                     { *@
@*                         working = true; *@
@*                         id = shift.Id; *@
@*                     } *@
@*                 } *@
@* *@
@*                 <td class="@(working ? "table-danger" : "table-success") p-4"> *@
@*                     @((working ? "Working" : "Not Working")); *@
@*                     @if (working && Model.shiftIdsToCancel.Contains(id)) *@
@*                     { *@
@*                         <a asp-page="/CallInSick" asp-route-id="@id" class="btn btn-primary btn-sm w-100">Cancel</a> *@
@*                     } *@
@*                 </td> *@
@*             } *@
@*         </tr> *@
@*         <tr> *@
@*             <td class="p-4">Evening</td> *@
@*             @for (int dayIndex = 0; dayIndex < Model.WeekDays.Count; dayIndex++) *@
@*             { *@
@*                 bool working = false; *@
@*                 int id = 0; *@
@*                 foreach (Shift shift in Model._assignedShifts) *@
@*                 { *@
@*                     if (shift.Date == Model.NewDate.AddDays(dayIndex - (int)Model.NewDate.DayOfWeek + 1) && shift.Type == (int)ShiftType.Evening) *@
@*                     { *@
@*                         working = true; *@
@*                         id = shift.Id; *@
@*                     } *@
@* *@
@*                 } *@
@* *@
@*                 <td class="@(working ? "table-danger" : "table-success") p-4"> *@
@*                     @((working ? "Working" : "Not Working")); *@
@*                     @if (working && Model.shiftIdsToCancel.Contains(id)) *@
@*                     { *@
@*                         <a asp-page="/CallInSick" asp-route-id="@id" class="btn btn-primary btn-sm w-100">Cancel</a> *@
@*                     } *@
@*                 </td> *@
@*             } *@
@*         </tr> *@
@*     </tbody> *@
@* </table> *@

<!--=====================================-->
<!--=        NEW DESIGN CODE         =-->
<!--=====================================-->
<div class="login">
    <video autoplay loop muted class="bg-video">
        <source src="assets/media/login/background.mp4" type="video/mp4">
    </video>
    <section class="login text-center">
        <div class="container">
            <div class="login-block">
                <div style="margin-top: 30px;" class="login-content">
                    <!-- Shifts Schedule Title -->
                    <h2 class="mt-3 section-title">
                        <img src="assets/media/login/Calendar.png" alt="Calendar Icon" class="section-icon"> Your Shifts:
                    </h2>
                    <p class="date-range-label">Shifts displayed for Date 1 - Date 7</p>

                    <hr class="section-divider">
                    <div class="calendar">
                        <div class="calendar-header">
                            <div class="calendar-header-item shift-type">Shift Type</div>
                            @for (int dayIndex = 0; dayIndex < Model.WeekDays.Count; dayIndex++)
                            {
                                var date = Model.NewDate.AddDays(dayIndex - (int)Model.NewDate.DayOfWeek + 1);
                                <div class="calendar-header-item">@Model.WeekDays[dayIndex]<br />@date.ToString("dd/MM/yyyy")</div>
                            }
                        </div>

    
                        <div class="calendar-content">
                            <!-- Replace with your actual shift types -->
                            @foreach (var shiftType in new[] { "Morning", "Afternoon", "Evening" })
                            {
                                <div class="calendar-row">
                                    <div class="calendar-day shift-type">@shiftType</div>
                                    
                                    @for (int dayIndex = 0; dayIndex < Model.WeekDays.Count; dayIndex++)
                                    {
                                        var date = Model.NewDate.AddDays(dayIndex - (int)Model.NewDate.DayOfWeek + 1);
                                        bool working = Model._assignedShifts.Any(shift => shift.Date == date && shift.Type.ToString() == shiftType);
                                        int shiftId = working ? Model._assignedShifts.First(shift => shift.Date == date && shift.Type.ToString() == shiftType).Id : 0;
                        
                                        <div class="calendar-day @(working ? "working" : "not-working")">
                                            @if (working)
                                            {
                                                <span>Working</span>
                                                @if (Model.shiftIdsToCancel.Contains(shiftId))
                                                {
                                                    <a asp-page="/CallInSick" asp-route-id="@shiftId" class="btn btn-primary btn-sm w-100">Cancel</a>
                                                }
                                            }
                                            else
                                            {
                                                <span>Not Working</span>
                                            }
                                        </div>
                                    }
                                </div>
                            }
                        </div>

                    </div>
                    <div class="shift-navigation-buttons">
                        <form method="post">
                            <button class="btn" asp-page-handler="PreviousWeek">PAST WEEK</button>
                            <button class="btn" asp-page-handler="CurrentWeek">CURRENT WEEK</button>
                            <button class="btn" asp-page-handler="NextWeek">FUTURE WEEK</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>